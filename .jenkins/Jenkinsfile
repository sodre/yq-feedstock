#!/usr/bin/groovy
pipeline {
  agent none
  stages {
   stage('build') {
      parallel {
        stage('linux_python2.7') {
          agent {
            label 'condaforge/linux-anvil'
          }
          environment {
            CONFIG="${STAGE_NAME}"
            FEEDSTOCK_ROOT="${WORKSPACE}"
            RECIPE_ROOT="${FEEDSTOCK_ROOT}/recipe"
            ARTIFACTS="${FEEDSTOCK_ROOT}/build_artifacts"
          }
          steps {
            sh """#!/bin/bash -il
               conda activate base
               .circleci/build_steps.sh
               """
            fileExists '${ARTIFACTS}/conda-forge-build-done-${CONFIG}'
          }
        }
        stage('linux_python3.6') {
          agent {
            label 'condaforge/linux-anvil'
          }
          environment {
            CONFIG="${STAGE_NAME}"
            FEEDSTOCK_ROOT="${WORKSPACE}"
            RECIPE_ROOT="${FEEDSTOCK_ROOT}/recipe"
            ARTIFACTS="${FEEDSTOCK_ROOT}/build_artifacts"
          }
          steps {
            sh """#!/bin/bash -il
               conda activate base
               .circleci/build_steps.sh
               """
            fileExists '${ARTIFACTS}/conda-forge-build-done-${CONFIG}'
          }
        }
      }
    }
  }
}